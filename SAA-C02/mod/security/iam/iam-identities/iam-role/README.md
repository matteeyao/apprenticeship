# IAM Roles

> **IAM Roles**
>
> * Type of identity
>
> * Used by multiple principals
>
> * Temporary
>
> * Roles are assumed

A role is a level of access used to get the needed permissions. W/ a role, you become that identity for a short period of time.

> **IAM Users**
>
> * Type of identity
>
> * Single principal
>
> * Long-term credentials

> * Have identity policies attached that control the users' permissions:
>
>   * AWS managed policy
>
>   * Inline policy

Recall that **AWS managed policies** and **inline policies** are permission policies that grant or deny access.

> **IAM Roles**
>
> * Have two types of policies that can be attached:
>
>   * **Trust policy**
>
>   * **Permission policy**

## Trust Policy

> * Controls which identity can **assume the role**
>
> * Can reference IAM users, other IAM roles, AWS services, and identities in other AWS accounts, FB, Google, etc.

## Permission Policy

> * Controls which permissions are allowed or denied

## Creating IAM Roles

![Fig. 1 IAM roles](../../../../../img/SAA-CO2/identity-access-management/identity-types/iam-role/diagram-I.png)

If an **IAM role** gets assumed by an identity type that is allowed to assume it from a trust policy, then AWS will generate temporary security credentials and give those back to the identity assuming the role. These temporary credentials are time limited and only work for short periods of time. When that identity assumes the IAM role w/ the temporary security credentials, then it is given access to whatever is allowed inside the **Permissions policy**. And when you assume a role, the temporary security credentials you receive are generated by an AWS service called **Secure Token Service** or STS.

The operation used to assume a role is `sts:AssumeRole`. Temporary credentials are time limited, and they will expire, but you can renew credentials by re-assuming the role. These temporary security credentials can access whichever permissions are in the permissions policy.

**Trust Policies** can reference other IAM users, IAM roles, and AS services, but can also reference identities in other AWS accounts, as well as FB, Google, etc.

Since roles are real identities in AWS, just as with **IAM users**, roles can be referenced in resource policies w/ the ARN.

![Fig. 2 IAM roles applicability](../../../../../img/SAA-CO2/identity-access-management/identity-types/iam-role/diagram-II.png)

It's AWS best practice to choose an IAM role since the service receives temporary security credentials to perform this task, and secures your environment versus hard-coding our credentials.

**IAM roles** can also be used when you want to reuse existing identities from an on-premise environment and want to access AWS resources. You cannot directly access AWS resources w/ an external account, but there is a process that allows you to allow users to use the external identities to access AWS resources. To do so, allow an IAM role inside our AWS account to be assumed by an external identity, which may be in an on-premise active directory. And it works the same way when the role is assumed by the external identity. Temporary credentials are generated and passed to that external user.

By allowing an external identity to assume an IAM role, we employ **Identity Federation**. And by using IAM roles w/ **Identity Federation**, we have a smaller number of roles to manage versus over 5000 IAM user accounts. And the external IDs can assume these roles to access the needed AWS services. **IAM roles** are also great for applications that need to access a database inside an AWS account.

We can use **Web Identity Federation** and an **IAM role** for this situation where millions of mobile users will require permissions to interact w/ our database. Our IAM role **trust policy** trusts these identities from Facebook, Google, or Amazon, and they will be able to assume that IAM role and they will be given temporary security credentials, and then will be allowed the permissions granted in the **Permissions policy**. By using **IAM roles**, application has no hard-coded credentials stored inside it, which makes the application much more secure and also makes our resources more secure as well. And customers' existing account on AMZN, FB, etc. is used so the user doesn't need to create a whole new account.

Using **Identity Federation** along w/ **IAM roles** is a great way to architect solutions for mobile development.

We also have cross account access using IAM roles. IAM users from an AWS account can assume an IAM role w/ the trust policy between two AWS accounts. The user or users can assume that role, receive those temporary security credentials, and then based on the permission policy, can log-in to the second AWS account and do whatever the permission policy allows.
