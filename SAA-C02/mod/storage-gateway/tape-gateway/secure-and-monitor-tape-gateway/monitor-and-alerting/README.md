# Monitor and Alerting

> Use CloudWatch and CloudTrail to monitor your Storage Gateway.

Storage Gateway integrates with services such as Amazon CloudWatch and AWS CloudTrail, so you can monitor the health of your storage gateway and track user activity.

Systematically monitoring AWS resources is the basis for determining the most valuable and efficient use of resources. Storage Gateway captures health and performance data and, in combination with AWS services, you can gain insight, automatically process, and react to specific metrics, thresholds, and events.

Storage Gateway health and performance logs and metrics include the following: 

* Audit logs that monitor your gateway for errors that it encounters.

* Metrics that track the health of your gateway over a period of time, considering both gateway-specific and volume-specific metrics.

## CloudWatch

You can monitor your gateway and associated resources in CloudWatch by using Storage Gateway health and performance logs and metrics.

The Storage Gateway console provides a consolidated view of CloudWatch metrics and any CloudWatch alarms you have configured.

## Metrics

Data throughput, data latency, and operations per second are three measures that you can use to understand how your application storage using the Storage Gateway is performing. The following table describes some of the Storage Gateway metrics that are available to you.

<table style="width:100%;margin-right:calc(0%);"><thead><tr><th style="width:21.8381%;"><span style="font-size:17px;">Metric</span></th><th style="width:78.0306%;"><span style="font-size:17px;">Description</span></th></tr></thead><tbody><tr><td style="width:21.8381%;"><span style="font-size:17px;">CacheHitPercent</span></td><td style="width:78.0306%;"><span style="font-size:17px;">Percent of application reads served from the cache. The sample is taken at the end of the reporting period.</span></td></tr><tr><td style="width:21.8381%;"><span style="font-size:17px;">CachePercentDirty</span></td><td style="width:78.0306%;"><span style="font-size:17px;">The tape's contribution to the overall percentage of the gateway's cache that has not been persisted to AWS.</span></td></tr><tr><td style="width:21.8381%;"><span style="font-size:17px;">CachePercentUsed</span></td><td style="width:78.0306%;"><span style="font-size:17px;">The tape's contribution to the overall percent use of the gateway's cache storage.</span></td></tr><tr><td style="width:21.8381%;"><span style="font-size:17px;">CloudBytesUploaded</span></td><td style="width:78.0306%;"><span style="font-size:17px;">The total number of bytes that the gateway uploaded to AWS during the reporting period.</span></td></tr><tr><td style="width:21.8381%;"><span style="font-size:17px;">CloudBytesDownloaded&nbsp;</span></td><td style="width:78.0306%;"><span style="font-size:17px;">The total number of bytes that the gateway downloaded from AWS during the reporting period.&nbsp;</span></td></tr><tr><td style="width:21.8381%;"><span style="font-size:17px;">CloudTraffic</span><br></td><td style="width:78.0306%;"><span style="font-size:17px;">The amount of bytes uploaded and downloaded from the cloud to the tape.</span><br></td></tr><tr><td style="width:21.8381%;"><span style="font-size:17px;">HealthNotifications</span></td><td style="width:78.0306%;"><span style="font-size:17px;">The number of health notifications that were generated by this gateway in the reporting period.</span></td></tr><tr><td style="width:21.8381%;"><span style="font-size:17px;">IoWaitPercent</span></td><td style="width:78.0306%;"><span style="font-size:17px;">Percent of time that the gateway is waiting on a response from the local disk.&nbsp;</span></td></tr><tr><td style="width:21.8381%;"><span style="font-size:17px;">MemUsedBytes</span><br></td><td style="width:78.0306%;"><span style="font-size:17px;">The percentage of allocated memory that is currently used by the tape.</span><br></td></tr><tr><td style="width:21.8381%;"><span style="font-size:17px;">MemTotalBytes</span><br></td><td style="width:78.0306%;"><span style="font-size:17px;">The percentage of total memory that is currently used by the tape.</span><br></td></tr><tr><td style="width:21.8381%;"><span style="font-size:17px;">ReadBytes&nbsp;</span></td><td style="width:78.0306%;"><span style="font-size:17px;">The total number of bytes read from your on-premises applications in the reporting period.&nbsp;</span></td></tr><tr><td style="width:21.8381%;"><span style="font-size:17px;">UserCpuPercent</span><br></td><td style="width:78.0306%;"><span style="font-size:17px;">The percentage of allocated CPU compute units for the user that are currently used by the tape.</span><br></td></tr><tr><td style="width:21.8381%;"><span style="font-size:17px;">WriteBytes&nbsp;</span></td><td style="width:78.0306%;"><span style="font-size:17px;">The total number of bytes written to your on-premises applications in the reporting period.</span></td></tr></tbody></table>

Example of using the metrics:

* Analyze the `CloudBytesDownloaded` and `CloudBytesUploaded` metrics to understand throughput between your gateway and the AWS Cloud.

* Calculate the percent of read requests that are served from the cache by using the `CacheHitPercent` metric with the Average statistic. The Average statistic of CloudWatch will sum all the metric values over a period of time and divide them by the number of samples.

* Use the `ReadTime` and `WriteTime` metrics with the Average statistic to measure latency.

* Monitor performance of your Storage Gateway by monitoring metrics like `CachePercentDirty`. The higher the percentage of dirty cache (overall percentage of the gateway's cache that has not persisted to AWS), the lower the space available for low-latency data.

* Use the `ReadBytes` and `WriteBytes` metrics with the Sum statistic to measure throughput from your on-premises applications coming into the gateway.

## CloudWatch log group 

If your gateway is deployed in a cluster—for example, enabled with VMware High Availability (HA)—and you need to know about any errors, you can configure a CloudWatch log group to monitor your gateway and get notified when your gateway encounters an error. You can either configure the group when you are activating the gateway or after your gateway is activated and up and running.

> ### Configure log group
>
> CloudWatch log groups can be configured at the time of gateway setup or edited at a later time.
>
> Choose to **Create a new log group**, **Use an existing log group**, or **Deactivate logging**.

## Metrics and CloudWatch alarms

You can set alarms to notify you of changes in workloads. Alarms can be based on a single metric or a combination of metrics. You can add alarms to CloudWatch dashboards and monitor them visually. An alarm can invoke an action when it changes state, based on an evaluation period, repetitions, and data points to evaluate.

> ### Recommended alarms
>
> For each activated gateway, it is recommended to create the following CloudWatch alarms:
>
> * High IO wait: IoWaitPercent >= 20 for 3 datapoints in 15 minutes
>
> * Cache percent dirty: CachePercentDirty > 80 for 4 datapoints within 20 minutes
>
> * Availability notifications: AvailabilityNotifications >= 1 for 1 datapoints within 5 minutes
>
> * Health notifications: HealthNotifications >= 1 for 1 datapoints within 5 minutes

> ### How to set an alarm
>
> Using the Storage Gateway console, choose the ***Monitoring*** tab from the selected gateway. Then choose **Create alarm**.

## CloudTrail

Storage Gateway API calls can be logged with CloudTrail. CloudTrail captures all API calls for Storage Gateway as events. It reports on the user who performed the action, such as type of user, account ID, and user name. It reports on the event, such as event name, timestamp, AWS Region, the IP address of the user, and a list of API parameters.

If you create a trail, you can store continuous delivery of CloudTrail events to an Amazon S3 bucket, including events for Storage Gateway. If you don't configure a trail, you can still view the most recent events in the CloudTrail console in Event history.

## Storage Gateway console

The Storage Gateway service console provides a status of the health of your gateways and tapes. If a gateway is not running, the service will try to reestablish connections automatically.
